// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./support/expressionUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(l,m,r,w,C,q,k,b,a,d,h,g,f,e,c,t,x,u,n,D,v){l=l(null,{declaredClass:"esri.PopupInfo",
_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,c){if(a){m.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var p=this._fieldLabels={},b=this._fieldsMap={};this.info.fieldInfos&&r.forEach(this.info.fieldInfos,function(a){var c=a.fieldName.toLowerCase(),y=this._isExpressionField(c)?this.getExpressionInfo(c):null;p[c]=y?y.title:a.label;
b[c]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return w.fromJson(w.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var c;r.some(this.info&&this.info.fieldInfos,function(p){p.fieldName===a&&(c=p);return!!c});return c},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,"");a=a.toLowerCase();var c;r.some(this.info.expressionInfos,
function(b){b.name.toLowerCase()===a&&(c=b);return!!c});return c}},hasGeometryOperations:function(){return r.some(this.info.expressionInfos,function(a){return n.hasGeometryOperations(a.expression)})},getComponents:function(a){var c=this.info,b={};c.fieldInfos&&(c=r.filter(c.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<c.length&&(b.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:c}));this._needFullResolutionFeature(a)&&(b.fullResolutionFeature=
this._getFullResolutionFeature(a));return e(b).then(m.hitch(this,function(c){return this._getPopupValues(a,c.fullResolutionFeature)}))},getAttachments:function(a){var c=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&c&&c.hasAttachments&&c.objectIdField&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"esriGeometryPoint"!==a.geometryType&&"function"===typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&
this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var b=a.getSourceLayer(),d=b.objectIdField;a=(a=a.attributes)&&d&&a[d];if(null==a)return null;var f=new c;f.objectIds=[a];f.maxAllowableOffset=0;f.outFields=[d];return b.queryFeatures(f).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var c={};r.forEach(a,function(a){var b=a.returnType&&a.returnType.toLowerCase();c[a.name]=D.createAttributeCache({valueExpression:a.expression},
"number"!==b)});return c},_fetchAttributes:function(a,c){var b=m.clone(a.attributes)||{},f=c&&c.geometry,e=this._exprPrefix,p=this._exprCache;r.forEach(this.info.expressionInfos,function(c){var y=e+c.name;c=(c=p[c.name])?a._getDataValue(c.attributeInfo,c,n,null,f):null;"string"===typeof c&&(c=d.encode(c));b[y]=c});return b},_getPopupValues:function(a,c,b){var d=this.info,f=a.getSourceLayer(),e=this._fetchAttributes(a,c),y=m.clone(e);c=d.fieldInfos;var p="",g="",t,n,A,u,F,x=f&&f._getDateOpts&&f._getDateOpts().properties,
x=x&&x.slice(0),k={dateFormat:{properties:x,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(u in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(u)){var v=this._relatedInfo[u],D=this._relatedLayersInfo[u];v&&(r.forEach(v.relatedFeatures,function(a){for(F in a.attributes)if(a.attributes.hasOwnProperty(F)&&"esriRelCardinalityOneToOne"===D.relation.cardinality){var c=this._toRelatedFieldName([D.relation.id,F]);e[c]=y[c]=a.attributes[F]}},
this),r.forEach(v.relatedStatsFeatures,function(a){for(F in a.attributes)if(a.attributes.hasOwnProperty(F)){var c=this._toRelatedFieldName([D.relation.id,F]);e[c]=y[c]=a.attributes[F]}},this))}c&&r.forEach(c,function(a){n=a.fieldName;var c=this._getLayerFieldInfo(f,n);c&&(n=a.fieldName=c.name);y[n]=this._formatValue(y[n],n,k);x&&a.format&&a.format.dateFormat&&(a=r.indexOf(x,n),-1<a&&x.splice(a,1))},this);if(f){u=f.types;var q=(v=f.typeIdField)&&e[v];for(n in e)if(e.hasOwnProperty(n)&&-1===n.indexOf(this._relatedFieldPrefix)&&
(A=e[n],h.isDefined(A))){var C=this._getDomainName(f,a,u,q,n,A);h.isDefined(C)?y[n]=C:n===v&&(C=this._getTypeName(f,a,A),h.isDefined(C)&&(y[n]=C))}}d.title&&(p=this._processFieldsInLinks(this._fixTokens(d.title,f),e),p=m.trim(h.substitute(y,p,k)||""));if(b)return{title:p};d.description&&(g=this._processFieldsInLinks(this._fixTokens(d.description,f),e),g=m.trim(h.substitute(y,g,k)||""));c&&(t=[],r.forEach(c,function(a){(n=a.fieldName)&&a.visible&&t.push([this._fieldLabels[n.toLowerCase()]||n,h.substitute(y,
"${"+n+"}",k)||""])},this));var l,w;d.mediaInfos&&(l=[],r.forEach(d.mediaInfos,function(a){w=0;A=a.value;switch(a.type){case "image":var c=A.sourceURL,c=c&&m.trim(h.substitute(e,this._fixTokens(c,f)));w=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":var b,c=A.normalizeField;A.fields=r.map(A.fields,function(a){return(b=this._getLayerFieldInfo(f,a))?b.name:a},this);c&&(b=this._getLayerFieldInfo(f,c),A.normalizeField=b?b.name:c);w=r.some(A.fields,function(a){return h.isDefined(e[a])||
-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(w){a=m.clone(a);A=a.value;var c=a.title?this._processFieldsInLinks(this._fixTokens(a.title,f),e):"",d=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,f),e):"";a.title=c?m.trim(h.substitute(y,c,k)||""):"";a.caption=d?m.trim(h.substitute(y,d,k)||""):"";if("image"===a.type)A.sourceURL=h.substitute(e,this._fixTokens(A.sourceURL,f)),A.linkURL&&(A.linkURL=m.trim(h.substitute(e,this._fixTokens(A.linkURL,
f))||""));else{var p,g;r.forEach(A.fields,function(a,c){if(-1!==a.indexOf(this._relatedFieldPrefix))g=this._getRelatedChartInfos(a,A,e,k),g instanceof Array?A.fields=g:A.fields[c]=g;else{var b=e[a],b=void 0===b?null:b;p=e[A.normalizeField]||0;b&&p&&(b/=p);A.fields[c]={y:b,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,k,!!p)}}},this)}l.push(a)}},this));return{title:p,description:g,hasDescription:!!d.description,fields:t&&t.length?t:null,mediaInfos:l&&l.length?
l:null,formatted:y,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},_getRelatedChartInfos:function(a,c,b,f){var d,e,y,p,g,t;d=[];t=this._fromRelatedFieldName(a);g=t[0];e=this._relatedInfo[g];g=this._relatedLayersInfo[g];e&&r.forEach(e.relatedFeatures,function(e){e=e.attributes;var g,n;for(n in e)if(e.hasOwnProperty(n)&&n===t[1]){g={};p=e[n];c.normalizeField&&(y=-1!==c.normalizeField.indexOf(this._relatedFieldPrefix)?e[this._fromRelatedFieldName(c.normalizeField)[1]]:b[c.normalizeField]);p&&
y&&(p/=y);if(c.tooltipField)if(-1!==c.tooltipField.indexOf(this._relatedFieldPrefix)){var A=this._fromRelatedFieldName(c.tooltipField)[1],u=h.isDefined(e[A])?this._formatValue(e[A],c.tooltipField,f,!!y):A;g.tooltip=u+":\x3cbr/\x3e"+this._formatValue(p,A,f,!!y)}else g.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(p,c.tooltipField,f,!!y);else g.tooltip=p;g.y=p;d.push(g)}},this);return"esriRelCardinalityOneToMany"===g.relation.cardinality||"esriRelCardinalityManyToMany"===
g.relation.cardinality?d:d[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",
longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_reEmptyHref:/^href\s*=\s*"\s*"$/i,_reEmptyHrefApos:/^href\s*=\s*'\s*'$/i,_fixTokens:function(a,c){var b=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,f,d){a=b._getLayerFieldInfo(c,d);return"$"+(a?"{"+a.name+"}":f)})},_encodeAttributes:function(a){a=m.clone(a)||
{};var c,b;for(c in a)(b=a[c])&&"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),a[c]=b);return a},_processFieldsInLinks:function(a,c){var b=this._encodeAttributes(c);c=m.hitch(this,this._addValuesToHref,c,b);a&&(a=a.replace(this._reHref,c).replace(this._reHrefApos,c));return a},_addValuesToHref:function(a,c,b,f){f=f&&m.trim(f);b=h.substitute(f&&0===f.indexOf("${")?a:c,b);this._reEmptyHref.test(b)?b='href\x3d"about:blank"':this._reEmptyHrefApos.test(b)&&(b="href\x3d'about:blank'");
return b},_getLayerFieldInfo:function(a,c){return a&&a.getField?a.getField(c):null},_formatValue:function(a,c,b,f){var d=this._fieldsMap[c.toLowerCase()],e=d&&d.format;c=-1!==r.indexOf(b.dateFormat.properties,c);var y="number"===typeof a&&!c&&(!e||!e.dateFormat);if(!h.isDefined(a)||!d||!h.isDefined(e))return y?this._forceLTR(a):a;var g="",d=[],t=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),n=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(t&&!c)g="NumberFormat",d.push("places: "+
(h.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),d.length&&(g+="("+d.join(",")+")");else if(e.dateFormat)g="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return y?this._forceLTR(a):a;var p=this._applyFormatting(a,g,b);t&&-1<a.constructor.toString().indexOf("Array")&&(p="",r.forEach(a,m.hitch(this,function(a,c){c&&(p+=" ");p+=this._applyFormatting(a,g,b)})));t&&!n&&v.group&&(p=p.replace(new RegExp("\\"+v.group,"g"),
""));c&&(p='\x3cspan class\x3d"esriDateValue"\x3e'+p+"\x3c/span\x3e");return y?this._forceLTR(p):p},_applyFormatting:function(a,c,b){return h.substitute({myKey:a},"${myKey:"+c+"}",b)||""},_forceLTR:function(a){var c=b("ie");return c&&10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=h.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,c,b,f,e,d){return(a=a.getDomain&&a.getDomain(e,
{feature:c}))&&a.codedValues?a.getName(d):null},_getTypeName:function(a,c,b){return(a=a.getType&&a.getType(c))&&a.name},_getRelatedRecords:function(a){var c=a.graphic,b;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(a).then(m.hitch(this,function(a){for(b in a)a.hasOwnProperty(b)&&a[b]&&(this._relatedLayersInfo[b].relatedLayerInfo=a[b])})));return this._relatedLayersInfoPromise.then(m.hitch(this,function(){return this._queryRelatedLayers(c)})).then(m.hitch(this,
function(a){this._setRelatedRecords(c,a);return a}))},_getRelatedLayersInfo:function(c){var b=c.fieldsInfo,e,d,g={};e=c.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});r.forEach(b,function(a){var c,b,d,f;c=this._fromRelatedFieldName(a.fieldName);b=c[0];c=c[1];b&&(!this._relatedLayersInfo[b]&&e&&e.relationships&&(r.some(e.relationships,function(a){if(a.id==b)return f=a,!0}),f&&(this._relatedLayersInfo[b]={relation:f,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[b]&&
(this._relatedLayersInfo[b].relatedFields.push(c),a.statisticType&&(d=new u,d.statisticType=a.statisticType,d.onStatisticField=c,d.outStatisticFieldName=c,this._relatedLayersInfo[b].outStatistics.push(d))))},this);for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&this._relatedLayersInfo[d]&&(c=this._relatedLayersInfo[d].relation,c=e.url.replace(/[0-9]+$/,c.relatedTableId),this._relatedLayersInfo[d].relatedLayerUrl=c,g[d]=f({url:c,content:{f:"json"},callbackParamName:"callback"}));
return a(g)},_queryRelatedLayers:function(c){var b={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(b[d]=this._queryRelatedLayer({graphic:c,relatedInfo:this._relatedLayersInfo[d]}));return a(b)},_queryRelatedLayer:function(b){var d,e,f,g,h,y,n,p,u,x,v,D,q;d=b.graphic;e=d.getSourceLayer();f=e.url.match(/[0-9]+$/g)[0];v=b.relatedInfo;x=v.relatedLayerInfo;D=v.relatedLayerUrl;b=v.relation;r.some(x.relationships,function(a){if(a.relatedTableId===parseInt(f,10))return g=
a,!0},this);g&&(h=new c,r.some(x.fields,function(a){if(a.name===g.keyField)return p=-1!==r.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),g.relationshipTableId&&g.keyFieldInRelationshipTable?(q=new k,this._queryRelatedRecords(d,g).then(m.hitch(this,function(a){var b;(b=a[d.attributes[e.objectIdField]])?(a=r.map(b.features,function(a){return a.attributes[x.objectIdField]},this),v.outStatistics&&0<v.outStatistics.length&&
x.supportsStatistics&&(u=new c,u.objectIds=a,u.outFields=h.outFields,u.outStatistics=v.outStatistics),u&&(y=new t(D),y.execute(u).then(m.hitch(this,function(a){var c=[];c.push(b);c.push(a);q.resolve(c)})))):q.resolve()}))):(n="string"===p?g.keyField+"\x3d'"+d.attributes[b.keyField]+"'":g.keyField+"\x3d"+d.attributes[b.keyField],h.where=n,h.outFields=v.relatedFields,v.outStatistics&&0<v.outStatistics.length&&x.supportsStatistics&&(u=new c,u.where=h.where,u.outFields=h.outFields,u.outStatistics=v.outStatistics),
y=new t(D),n=[],n.push(y.execute(h)),u&&n.push(y.execute(u))));return n?a(n):q?q.promise:void 0},_setRelatedRecords:function(a,c){this._relatedInfo=[];for(var b in c)c.hasOwnProperty(b)&&c[b]&&(a=c[b],this._relatedInfo[b]={},this._relatedInfo[b].relatedFeatures=a[0].features,h.isDefined(a[1])&&(this._relatedInfo[b].relatedStatsFeatures=a[1].features))},_handlerErrorResponse:function(a,c){a.reject(c)},_fromRelatedFieldName:function(a){var c=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),
c=a.slice(1));return c},_toRelatedFieldName:function(a){var c="";a&&0<a.length&&(c=this._relatedFieldPrefix+a[0]+"/"+a[1]);return c},_queryRelatedRecords:function(a,c){var b=a.getSourceLayer(),d=new x;d.outFields=["*"];d.relationshipId=c.id;d.objectIds=[a.attributes[b.objectIdField]];return b.queryRelatedFeatures(d)}});q("extend-esri")&&(g.PopupInfo=g.PopupInfoTemplate=l);return l})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(l){var m=l.getObject("dojox.html.entities",!0),
r=function(m,q){var k,b;if(q._encCache&&q._encCache.regexp&&q._encCache.mapper&&q.length==q._encCache.length)k=q._encCache.mapper,b=q._encCache.regexp;else{k={};b=["["];var a;for(a=0;a<q.length;a++)k[q[a][0]]="\x26"+q[a][1]+";",b.push(q[a][0]);b.push("]");b=new RegExp(b.join(""),"g");q._encCache={mapper:k,regexp:b,length:q.length}}return m=m.replace(b,function(a){return k[a]})},w=function(m,q){var k,b;if(q._decCache&&q._decCache.regexp&&q._decCache.mapper&&q.length==q._decCache.length)k=q._decCache.mapper,
b=q._decCache.regexp;else{k={};b=["("];var a;for(a=0;a<q.length;a++){var d="\x26"+q[a][1]+";";a&&b.push("|");k[d]=q[a][0];b.push(d)}b.push(")");b=new RegExp(b.join(""),"g");q._decCache={mapper:k,regexp:b,length:q.length}}return m=m.replace(b,function(a){return k[a]})};m.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7",
"sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2",
"Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc",
"Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6",
"ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1",
"Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5",
"upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2",
"rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260",
"ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],
["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(l,q){l&&(q?l=r(l,q):(l=r(l,m.html),l=r(l,m.latin)));
return l};m.decode=function(l,q){l&&(q?l=w(l,q):(l=w(l,m.html),l=w(l,m.latin)));return l};return m})},"esri/promiseList":function(){define(["dojo/_base/array","dojo/Deferred","dojo/when"],function(l,m,r){var w=l.forEach;return function(l){function q(b,c){a[c]=b;g.progress([b,c]);0===--f&&g.resolve(a)}var k,b;l instanceof Array?b=l:l&&"object"===typeof l&&(k=l);var a,d=[];if(k){b=[];for(var h in k)Object.hasOwnProperty.call(k,h)&&(d.push(h),b.push(k[h]));a={}}else b&&(a=[]);if(!b||!b.length)return(new m).resolve(a);
var g=new m;g.promise.always(function(){a=d=null});var f=b.length;w(b,function(a,c){k||d.push(c);r(a,function(a){g.isFulfilled()||q(a,d[c])},function(a){g.isFulfilled()||q(a,d[c])})});return g.promise}})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(l,m,r,w,C,q,k,b,a,d,h,g,f){var e=
l(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(a){this._handleSuccess=m.hitch(this,this._handleSuccess);this._handleError=m.hitch(this,this._handleError);m.mixin(this,a);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var a=new w(this._canceler);this._fetchDfd=a;this._result=null;this._sendRequest();return a.promise},_canceler:function(a){var c=a._pendingRequest,
b;a.isFulfilled()||!c||c.isFulfilled()||(c.cancel(),b=c.results&&c.results[1]);a._pendingRequest=null;return b},_sendRequest:function(a){var c=this.query;this.pagination&&(this._startPage=c.resultOffset=null==a?0:a,c.resultRecordCount=this.pageSize);this._fetchDfd._pendingRequest=b({url:this.url,content:c,handleAs:"pbf"===c.f?"arraybuffer":"json",callbackParamName:"callback"},this.requestOptions);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(a){this.pagination?
(a.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(a.features):this._result=a,this._fetchDfd.progress(a),a.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(a),this._fetchDfd.resolve(a))},_handleError:function(a){this._fetchDfd.reject(a)}});l=l(g,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],
"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=m.hitch(this,this._handler);this._relationshipQueryHandler=m.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=m.hitch(this,this._executeForIdsHandler);this._countHandler=m.hitch(this,this._countHandler);this._extentHandler=m.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],
e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(a,d,f,e,g){e=g.assembly;a=this._encode(m.mixin({},
this._url.query,{f:"json"},a.toJson(e&&e[0])));var c=this._handler,h=this._errorHandler;this.source&&(e={source:this.source.toJson()},a.layer=C.toJson(e));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,b){c(a,b,d,f,g.dfd)},error:function(a){h(a,f,g.dfd)}},this.requestOptions)},rawExecute:function(a,b,d){b=b||{};a=this._encode(m.mixin({},this._url.query,{f:b.format||"json"},a.toJson(d.assembly&&d.assembly[0])));
this.source&&(a.layer=C.toJson({source:this.source.toJson()}));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return(new e({url:this._url.path+"/query",query:a,requestOptions:this.requestOptions,pagination:b.pagination,pageSize:b.pageSize})).execute().then(null,null,function(a){d.dfd.progress(a)}).then(m.hitch(this,function(a){this._successHandler([a],"onRawExecuteComplete",null,d.dfd)})).otherwise(m.hitch(this,function(a){this._errorHandler(a,null,d.dfd)}))},executeRelationshipQuery:function(c,
d,f){c=this._encode(m.mixin({},this._url.query,{f:"json"},c.toJson()));var e=this._relationshipQueryHandler,g=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var h=new w(a._dfdCanceller);h._pendingDfd=b({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(a,c){e(a,c,d,f,h)},error:function(a){g(a,f,h)}},this.requestOptions);return h},executeForIds:function(a,d,f,e){var c=e.assembly;a=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
a.toJson(c&&c[0])));var g=this._executeForIdsHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=C.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,f,e.dfd)},error:function(a){h(a,f,e.dfd)}},this.requestOptions)},executeForCount:function(a,d,f,e){var c=e.assembly;a=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(c&&
c[0])));var g=this._countHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=C.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,f,e.dfd)},error:function(a){h(a,f,e.dfd)}},this.requestOptions)},executeForExtent:function(a,d,e,f){var c=f.assembly;a=this._encode(m.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(c&&c[0])));
var g=this._extentHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=C.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,e,f.dfd)},error:function(a){h(a,e,f.dfd)}},this.requestOptions)},_handler:function(a,b,d,e,g){try{var c=new f(a);this._successHandler([c],"onComplete",d,g)}catch(v){this._errorHandler(v,e,g)}},_relationshipQueryHandler:function(a,b,d,e,
g){try{var c=a.geometryType,h=a.spatialReference,n={};r.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=c;b.spatialReference=h;b.features=a.relatedRecords;b=new f(b);if(null!=a.objectId)n[a.objectId]=b;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(n[a[d]]=b)});this._successHandler([n],"onExecuteRelationshipQueryComplete",d,g)}catch(A){this._errorHandler(A,e,g)}},_executeForIdsHandler:function(a,b,d,e,f){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
d,f)}catch(D){this._errorHandler(D,e,f)}},_countHandler:function(a,b,d,e,f){try{var c,g=a.features,h=a.objectIds;if(h)c=h.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");c=a.count}this._successHandler([c],"onExecuteForCountComplete",d,f)}catch(A){this._errorHandler(A,e,f)}},_extentHandler:function(a,b,e,f,g){try{a.extent&&(a.extent=new d(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",e,g)}catch(D){this._errorHandler(D,f,g)}}});h._createWrappers(l);
q("extend-esri")&&m.setObject("tasks.QueryTask",l,k);return l})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(l,m,r,w,C,q,k,b){l=l(b,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&m.isString(a)&&(this._url=k.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;
this._errorHandler=m.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},_encode:function(a,b,h){var d,f,e={},c,t;for(c in a)if("declaredClass"!==c&&(d=a[c],f=typeof d,null!==d&&void 0!==d&&"function"!==f))if(m.isArray(d))for(e[c]=[],t=d.length,f=0;f<t;f++)e[c][f]=this._encode(d[f]);else"object"===f?d.toJson&&(f=d.toJson(h&&h[c]),"esri.tasks.FeatureSet"===
d.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),e[c]=b?f:r.toJson(f)):e[c]=d;return e},_successHandler:function(a,b,h,g){b&&this[b].apply(this,a);h&&h.apply(null,a);g&&q._resDfd(g,a)},_errorHandler:function(a,b,h){this.onError(a);b&&b(a);h&&h.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});w("extend-esri")&&(C.Task=l);return l})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(l,m,r,w,C,q,k,b,a,d,h,g){l=l(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a,d){if(a){m.mixin(this,a);var c=this.features=this.features||[],e=a.spatialReference,e=this.spatialReference=h.createInstance(b.simpleConstructor,e),f=h.getGeometryType(a.geometryType);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);a=h.supportsLazyUnquantization(this.geometryType);var u=h.unquantizeFunction(this.geometryType,this.transform),n=!!(d&&a&&u),D=f&&(n?f.accessorConstructor:
f.simpleConstructor);r.forEach(c,function(a,d){var t=h.createInstance(k.simpleConstructor),p=a.geometry;if(f&&p){var v=t.geometry=h.createInstance(D,n?null:p);v.setSpatialReference(p.spatialReference?h.createInstance(b.simpleConstructor,p.spatialReference):e);n&&v.setupLazyUnquantization(u,p)}t.symbol=a.symbol?g.fromJson(a.symbol):null;t.attributes=a.attributes;c[d]=t});n||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var d=
{};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=h.getJsonType(this.features[0].geometry)),d.features=a._encodeGraphics(this.features,b));d.geometryType=d.geometryType||this.geometryType;d.exceededTransferLimit=
this.exceededTransferLimit;d.transform=this.transform;return q.fixJson(d)},_hydrate:function(){h.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],d=a.scale[0],f=a.scale[1],g=this.features,h=function(a,b,c){var d,e,f,g,h,n,t=[];d=0;for(e=a.length;d<e;d++)if(f=a[d],0<d){if(n=b(f[0]),f=c(f[1]),n!==g||f!==h)t.push([n-g,f-h]),g=n,h=f}else g=b(f[0]),h=c(f[1]),t.push([g,
h]);return 0<t.length?t:null},k=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,f,e,g,n;e=a.rings||a.paths;n=[];d=0;for(f=e.length;d<f;d++)g=e[d],(g=h(g,b,c))&&n.push(g);return 0<n.length?(a.rings?a.rings=n:a.paths=n,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=h(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,
function(a){return Math.round((a-b)/d)},function(a){return Math.round((c-a)/f)}),v,p;v=0;for(p=g.length;v<p;v++)g[v].geometry&&(k(g[v].geometry)||g[v].setGeometry(null));this.transform=a;return this}});l.createGraphics=function(a){var d=a.geometryType,c=h.createInstance(b.simpleConstructor,a.spatialReference),f=h.getGeometryType(d).accessorConstructor,g=h.unquantizeFunction(d,a.transform);return r.map(a.features,function(a,b){b=h.createInstance(k.simpleConstructor);var d=a.geometry;if(d){var e=b.geometry=
h.createInstance(f);e.setSpatialReference(c);e.setupLazyUnquantization(g,d)}b.attributes=a.attributes;return b})};l.createPolygon=function(a,b,c){var f;a&&(f=h.createInstance(d.accessorConstructor),f.setSpatialReference(b),b=h.unquantizeFunction("esriGeometryPolygon",c),f.setupLazyUnquantization(b,a));return f};w("extend-esri")&&m.setObject("tasks.FeatureSet",l,C);return l})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],
function(l,m,r,w,C){l=l(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var l={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},k=this.objectIds,b=this.outFields,a=this.outSpatialReference,d=
this.orderByFields;k&&(l.objectIds=k.join(","));b&&(l.outFields=b.join(","));a&&(l.outSR=a.wkid||r.toJson(a.toJson()));d&&(l.orderByFields=d.join(","));l._ts=this._ts;return l}});w("extend-esri")&&m.setObject("tasks.RelationshipQuery",l,C);return l})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(l,m,r,w){l=l(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,
outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});r("extend-esri")&&m.setObject("tasks.StatisticDefinition",l,w);return l})},"esri/core/timerUtils":function(){define([],function(){function l(l){var k,b=l.length;for(k=0;k<b;k++)l[k]()}var m={LOW:1,HIGH:2},r,w={};w[m.LOW]=[];w[m.HIGH]=[];var C=function(){clearTimeout(r);r=null;var q=w[m.HIGH];w[m.HIGH]=[];l(q);q=w[m.LOW];w[m.LOW]=[];l(q)};return{priority:m,
callbackQueue:w,setTimeout:function(l,k){l=[k,w[k].push(l)-1];r||(r=setTimeout(C,0));return l},clearTimeout:function(l){l&&w[l[0]].splice(l[1],1)}}})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(l,m,r,w,C,q){l=l(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=
null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(k,b){this._labelLayer=b;this._xmin=k.extent.xmin;this._xmax=k.extent.xmax;this._ymin=k.extent.ymin;this._ymax=k.extent.ymax;this._scale=(this._xmax-this._xmin)/k.width},_process:function(k){this._preparedLabels=k;this._placedLabels=[];var b;for(k=this._preparedLabels.length-1;0<=k;k--){var a=this._preparedLabels[k],d=Math.min(a.labelWidth,a.labelHeight),h=a.labelWidth+0*d,d=a.labelHeight+
0*d,g=(b=a.options)&&void 0!==b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",f=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:"Above",e=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",c=[2,2,1,3,0,2,3,3,2];"AboveLeft"==e?c=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==e?c=[2,1,2,2,0,2,3,3,3]:"AboveRight"==e?c=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==e?c=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==e?c=[0,0,0,0,1,0,0,0,0]:"CenterRight"==e?c=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==e?c=[2,3,3,2,0,3,1,2,2]:
"BelowCenter"==e?c=[3,3,3,2,0,2,2,1,2]:"BelowRight"==e&&(c=[3,3,2,3,0,2,2,2,1]);var t=b&&void 0!==b.labelRotation?b.labelRotation:!0,e=Math.PI/180*a.angle;b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,e,h,d,a.symbolWidth,a.symbolHeight,c);else if("multipoint"==a.geometry.type)for(g=a.geometry,f=0;f<g.points.length;f++)this._generatePointPositions(a,g.points[f][0],g.points[f][1],a.text,e,h,d,a.symbolWidth,
a.symbolHeight,c);else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,h,d,2*a.symbolHeight+d,g,f,t):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,e,h,d)}return this._placedLabels},_generatePointPositions:function(k,b,a,d,h,g,f,e,c,t){e=(e+g)*this._scale;c=(c+f)*this._scale;var x,u;for(x=1;3>=x;x++)for(u=1;9>=u;u++)if(t[u-1]==x)switch(u){case 1:if(this._findPlace(k,d,b-e,a+c,h,g,f))return;break;case 2:if(this._findPlace(k,d,b,a+c,h,g,f))return;
break;case 3:if(this._findPlace(k,d,b+e,a+c,h,g,f))return;break;case 4:if(this._findPlace(k,d,b-e,a,h,g,f))return;break;case 5:if(this._findPlace(k,d,b,a,h,g,f))return;break;case 6:if(this._findPlace(k,d,b+e,a,h,g,f))return;break;case 7:if(this._findPlace(k,d,b-e,a-c,h,g,f))return;break;case 8:if(this._findPlace(k,d,b,a-c,h,g,f))return;break;case 9:if(this._findPlace(k,d,b+e,a-c,h,g,f))return}},_generateLinePositions:function(k,b,a,d,h,g,f,e,c){var t=d*this._scale*d*this._scale,x,u,n;for(x=0;x<b.paths.length;x++){var D=
b.paths[x],v=D.length,p=Math.floor((v-1)/2),l=0!==(v-1)%2?1:-1;"PlaceAtStart"==f&&(p=0,l=1);"PlaceAtEnd"==f&&(p=v-2,l=-1);for(;0<=p&&p<v-1;){for(u=p;u<v;u++){var m=D[p][0],B=D[p][1],r=D[u][0]-m,q=D[u][1]-B;if(r*r+q*q>t){for(var y=Math.atan2(q,r);y>Math.PI/2;)y-=Math.PI;for(;y<-(Math.PI/2);)y+=Math.PI;var E=Math.sin(y),G=Math.cos(y),I=0,J=0;"Above"==e&&(I=g*E*this._scale,J=g*G*this._scale);"Below"==e&&(I=-g*E*this._scale,J=-g*G*this._scale);if(1==u-p){if(this._clipLine(m,B,D[u][0],D[u][1])&&(m=this._x1-
this._x0,n=this._y1-this._y0,m*m+n*n>t&&(u=Math.atan2(n,m),r=d/2+2*h,B=r*this._scale*Math.cos(u),r=r*this._scale*Math.sin(u),"PlaceAtStart"==f?(m=this._x0+B,n=this._y0+r):"PlaceAtEnd"==f?(m=this._x1-B,n=this._y1-r):(m=this._x0+m/2,n=this._y0+n/2),this._findPlace(k,a,m-I,n+J,c?-u:0,d,h))))return}else{var K=0;for(n=p;n<=u;n++)K=Math.max(K,Math.abs((D[n][1]-B)*G-(D[n][0]-m)*E));if(K<h&&this._findPlace(k,a,m+r/2-I,B+q/2+J,c?-y:0,d,h))return}break}}p+=l}}},_generatePolygonPositions:function(k,b,a,d,h,
g,f){var e;if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)e=a.rings[b],q.prototype.isClockwise(e)&&(e=this._findCentroid(e,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(k,d,e[0],e[1],h,g,f));else{e=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var c=e[1],t=0;for(b=0;10>b;b++){t+=f/4;e=this._findCentroidForFeature(a,this._xmin,c+(t-f/4),this._xmax,c+(t+f/4));if(this._findPlace(k,d,e[0],e[1],h,g,f))break;e=this._findCentroidForFeature(a,this._xmin,c-(t+
f/4),this._xmax,c-(t-f/4));if(this._findPlace(k,d,e[0],e[1],h,g,f))break}}},_findCentroid:function(k,b,a,d,h){var g=k.length,f=[0,0],e=0,c=k[0][0],t=k[0][1];c>d&&(c=d);c<b&&(c=b);t>h&&(t=h);t<a&&(t=a);for(var x=1;x<g-1;x++){var u=k[x][0],n=k[x][1],l=k[x+1][0],v=k[x+1][1];u>d&&(u=d);u<b&&(u=b);n>h&&(n=h);n<a&&(n=a);l>d&&(l=d);l<b&&(l=b);v>h&&(v=h);v<a&&(v=a);var p=(u-c)*(v-t)-(l-c)*(n-t);f[0]+=p*(c+u+l);f[1]+=p*(t+n+v);e+=p}f[0]/=3*e;f[1]/=3*e;if(isNaN(f[0])||isNaN(f[1]))return f;a=[];this._fillBuffer(k,
a,f);f[0]=this._sortBuffer(a,f[0],b,d);return f},_findCentroidForFeature:function(k,b,a,d,h){for(var g,f=0,e=[0,0],c=0;c<k.rings.length;c++){var t=k.rings[c],x=t.length,u=t[0][0],n=t[0][1];u>d&&(u=d);u<b&&(u=b);n>h&&(n=h);n<a&&(n=a);for(g=1;g<x-1;g++){var l=t[g][0],v=t[g][1],p=t[g+1][0],m=t[g+1][1];l>d&&(l=d);l<b&&(l=b);v>h&&(v=h);v<a&&(v=a);p>d&&(p=d);p<b&&(p=b);m>h&&(m=h);m<a&&(m=a);var r=(l-u)*(m-n)-(p-u)*(v-n);e[0]+=r*(u+l+p);e[1]+=r*(n+v+m);f+=r}}e[0]/=3*f;e[1]/=3*f;if(isNaN(e[0])||isNaN(e[1]))return e;
a=[];for(g=0;g<k.rings.length;g++)this._fillBuffer(k.rings[g],a,e);e[0]=this._sortBuffer(a,e[0],b,d);return e},_fillBuffer:function(k,b,a){for(var d=k.length-1,h=k[0][1]>=k[d][1]?1:-1,g=0;g<=d;g++){var f=g,e=g+1;g==d&&(e=0);var c=k[f][0],f=k[f][1],t=k[e][0],e=k[e][1],l=e>=f?1:-1;if(f<=a[1]&&a[1]<=e||e<=a[1]&&a[1]<=f)a[1]!=f&&a[1]!=e?(b.push((a[1]-f)*(t-c)/(e-f)+c),h=l):a[1]==f&&a[1]!=e?(h!=l&&b.push(c),h=l):a[1]!=f&&a[1]==e?(b.push(t),h=l):a[1]==f&&a[1]==e&&(1==h&&b.push(c),b.push(t),h=l)}},_sortBuffer:function(k,
b,a,d){var h=k.length;k.sort();if(0<h){for(var g=0,f=b=0;f<h-1;f+=2){var e=Math.abs(k[f+1]-k[f]);!(k[f]<=a&&k[f+1]<=a||k[f]>=d&&k[f+1]>=d)&&e>g&&(g=e,b=f)}h=k[b];k=k[b+1];h>d&&(h=d);h<a&&(h=a);k>d&&(k=d);k<a&&(k=a);b=(h+k)/2}return b},_findPlace:function(k,b,a,d,h,g,f){if(isNaN(a)||isNaN(d))return!1;for(var e=0;e<this._placedLabels.length;e++){var c=this._placedLabels[e].angle,t=this._placedLabels[e].width*this._scale,l=this._placedLabels[e].height*this._scale,u=this._placedLabels[e].x-a,n=this._placedLabels[e].y-
d;if(0===h&&0===c){if(this._findPlace2(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,u-t,n-l,u+t,n+l))return!1}else{var m=new C(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,null),v=0,p=1;0!==h&&(v=Math.sin(h),p=Math.cos(h));var A=u*p-n*v,u=u*v+n*p,c=c-h,v=Math.sin(c),p=Math.cos(c),r=-t*p- -l*v,n=-t*v+-l*p,c=+t*p- -l*v,B=+t*v+-l*p,t=A+r,l=u-n,v=A+c,p=u-B,r=A-r,n=u+n,A=A-c,u=u+B,c=new q;c.addRing([[t,l],[v,p],[r,n],[A,u],[t,l]]);if(m.intersects(c))return!1}}for(;h>Math.PI/2;)h-=
Math.PI;for(;h<-(Math.PI/2);)h+=Math.PI;e={};e.layer=k;e.text=b;e.angle=h;e.x=a;e.y=d;e.width=g;e.height=f;this._placedLabels.push(e);return!0},_findPlace2:function(k,b,a,d,h,g,f,e){return(k>=h&&k<=f||a>=h&&a<=f||k<=h&&a>=f)&&(b>=g&&b<=e||d>=g&&d<=e||b<=g&&d>=e)?!0:!1},_clipLine:function(k,b,a,d){for(var h=this._code(k,b),g=this._code(a,d);0!==h||0!==g;){if(0!==(h&g))return!1;var f=a-k,e=d-b;0!==h?(k<this._xmin?(b+=e*(this._xmin-k)/f,k=this._xmin):k>this._xmax?(b+=e*(this._xmax-k)/f,k=this._xmax):
b<this._ymin?(k+=f*(this._ymin-b)/e,b=this._ymin):b>this._ymax&&(k+=f*(this._ymax-b)/e,b=this._ymax),h=this._code(k,b)):(a<this._xmin?(d+=e*(this._xmin-a)/f,a=this._xmin):a>this._xmax?(d+=e*(this._xmax-a)/f,a=this._xmax):d<this._ymin?(a+=f*(this._ymin-d)/e,d=this._ymin):d>this._ymax&&(a+=f*(this._ymax-d)/e,d=this._ymax),g=this._code(a,d))}this._x0=k;this._y0=b;this._x1=a;this._y1=d;return!0},_code:function(k,b){var a=0;k<this._xmin&&(a+=8);k>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=
1);return a}});r("extend-esri")&&m.setObject("layers.labelLayerUtils.DynamicLabelClass",l,w);return l})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(l,m,r,w,C,q,k){return l(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=
this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,d,h,g,f,e,c,t,l;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];f=a.labelWidth;
e=a.labelHeight;t=(c=a.options)&&c.lineLabelPlacement?c.lineLabelPlacement:"PlaceAtCenter";l=c&&c.lineLabelPosition?c.lineLabelPosition:"Above";d=c&&c.labelRotation?c.labelRotation:!0;h=Math.PI/180*a.angle;g=c&&c.howManyLabels?c.howManyLabels:"OneLabel";var u=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,h,f,e,a.symbolWidth,a.symbolHeight,c,u);else if("multipoint"===a.geometry.type)for(d=0;d<a.geometry.points.length;d++)this._generatePointPositions(a.geometry.points[d][0],
a.geometry.points[d][1],a.text,h,f,e,a.symbolWidth,a.symbolHeight,c,u);else if("polyline"===a.geometry.type)if("PlaceAtStart"===t)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,f,e,2*a.symbolHeight+e,t,l,d,u);else if("PlaceAtEnd"===t)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,f,e,2*a.symbolHeight+e,t,l,d,u);else{c=[];var n=a.geometry.getExtent(),m=this._map.extent;if(n.getWidth()<f*this._scale/this._OVERRUN&&n.getHeight()<f*this._scale/this._OVERRUN)continue;else.5*n.getWidth()<
m.getWidth()&&.5*n.getHeight()<m.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,e,2*a.symbolHeight+e,t,l,d,c):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,e,2*a.symbolHeight+e,t,l,d,c);this._postSorting(m,c,u)}else if("polygon"===a.geometry.type){t=[];for(d=0;d<a.geometry.rings.length;d++)l=a.geometry.rings[d],1<a.geometry.rings.length&&
!k.prototype.isClockwise(l)||(c=this._calcRingExtent(l),c.xmax-c.xmin<4*f*this._scale/this._OVERRUN&&c.ymax-c.ymin<4*e*this._scale/this._OVERRUN||t.push(l));t.sort(function(a,b){return b.length-a.length});for(d=0;d<t.length;d++)this._generatePolygonPositionsForManyLabels(t[d],a.geometry.spatialReference,a.text,h,f,e,u)}for(d=0;d<u.length&&(t=u[d].x,l=u[d].y,void 0!==u[d].angle&&(h=u[d].angle),c=this._findPlace(a,a.text,t,l,h,f,e),"OneLabel"!==g||!c||!this._labelLayer._isWithinScreenArea(new q(t,l,
a.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(b,a,d,h,g,f,e,c,t,l){d=t&&t.pointPriorities?t.pointPriorities:"AboveRight";g=(e+g)*this._scale;f=(c+f)*this._scale;switch(d.toLowerCase()){case "aboveleft":b-=g;a+=f;break;case "abovecenter":a+=f;break;case "aboveright":b+=g;a+=f;break;case "centerleft":b-=g;break;case "centercenter":break;case "centerright":b+=g;break;case "belowleft":b-=g;a-=f;break;case "belowcenter":a-=f;break;case "belowright":b+=
g;a-=f;break;default:return}l.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,d,h,g,f,e,c,t,l){e=h*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,n,m,v,p,r,x,B,q;for(n=0;n<b.paths.length;n++){var z=b.paths[n],y=e,E=0;for(m=0;m<z.length-1;m++)v=z[m][0],p=z[m][1],r=z[m+1][0],x=z[m+1][1],B=r-v,q=x-p,B=Math.sqrt(B*B+q*q),E+B>y?(E=this._generatePositionsOnLine(b.spatialReference,a,y,k,E,v,p,r,x,d,h,g,f,c,t,l),y=k):E+=B}},_generateLinePositionsPlaceAtEnd:function(b,
a,d,h,g,f,e,c,t,l){e=h*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,n,m,v,p,r,x,B,q;for(n=0;n<b.paths.length;n++){var z=b.paths[n],y=e,E=0;for(m=z.length-2;0<=m;m--)v=z[m+1][0],p=z[m+1][1],r=z[m][0],x=z[m][1],B=r-v,q=x-p,B=Math.sqrt(B*B+q*q),E+B>y?(E=this._generatePositionsOnLine(b.spatialReference,a,y,k,E,v,p,r,x,d,h,g,f,c,t,l),y=k):E+=B}},_generateLinePositionsPlaceAtCenter:function(b,a,d,h,g,f,e,c,t,l,k){var n,u,m,p,r,x,q,w;for(c=0;c<b.paths.length;c++){var z=
b.paths[c];if(!(2>z.length)){if(2==z.length){p=z[0];n=z[1];m=p[0];p=p[1];z=n[0];x=n[1];r=(z-m)*(z-m)+(x-p)*(x-p);q=Math.atan2(x-p,z-m);x=Math.cos(q);q=Math.sin(q);z=[];w=m;for(var y=p;(w-m)*(w-m)+(y-p)*(y-p)<r;)z.push([w,y]),w+=d/2*x,y+=d/2*q;z.push(n)}var E=0;for(n=0;n<z.length-1;n++)m=z[n][0],p=z[n][1],r=z[n+1][0],x=z[n+1][1],q=r-m,w=x-p,E+=Math.sqrt(q*q+w*w);for(n=y=0;n<z.length-1;n++){m=z[n][0];p=z[n][1];r=z[n+1][0];x=z[n+1][1];q=r-m;w=x-p;q=Math.sqrt(q*q+w*w);if(y+q>E/2)break;y+=q}n==z.length-
1&&n--;m=z[n][0];p=z[n][1];r=z[n+1][0];x=z[n+1][1];q=r-m;w=x-p;y=E/2-y;q=Math.atan2(w,q);w=m+y*Math.cos(q);q=p+y*Math.sin(q);m=this._angleAndShifts(m,p,r,x,e,t,l);k.push({x:w+m.shiftX,y:q+m.shiftY,angle:m.angle});var E=w,G=q,y=0;for(u=n;u<z.length-1;u++)u==n?(m=E,p=G):(m=z[u][0],p=z[u][1]),r=z[u+1][0],x=z[u+1][1],q=r-m,w=x-p,q=Math.sqrt(q*q+w*w),y=y+q>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,y,m,p,r,x,h,g,f,e,t,l,k):y+q;y=0;for(u=n;0<=u;u--)u==n?(m=E,p=G):(m=z[u+1][0],p=z[u+1][1]),
r=z[u][0],x=z[u][1],q=r-m,w=x-p,q=Math.sqrt(q*q+w*w),y=y+q>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,y,m,p,r,x,h,g,f,e,t,l,k):y+q}}},_generatePositionsOnLine:function(b,a,d,h,g,f,e,c,t,l,k,n,m,q,p,r){l=Math.atan2(t-e,c-f);k=f;n=e;var u=k,x=n;do if(g=d-g,k+=g*Math.cos(l),n+=g*Math.sin(l),this._belongs(k,n,f,e,c,t))g=this._angleAndShifts(f,e,c,t,m,q,p),d=k+g.shiftX,x=n+g.shiftY,a?this._labelLayer._isWithinScreenArea(new C(d,x,d,x,b))&&r.push({x:d,y:x,angle:g.angle}):r.push({x:d,y:x,angle:g.angle}),
u=k,x=n,g=0,d=h;else return b=c-u,t-=x,Math.sqrt(b*b+t*t);while(1)},_postSorting:function(b,a,d){if(b&&0<a.length){var h=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var g=a[0].x,f=a[0].y,e=Math.sqrt((g-h)*(g-h)+(f-b)*(f-b)),c=a[0].angle,t=0;t<a.length;t++){var k=a[t].x,l=a[t].y,n=Math.sqrt((k-h)*(k-h)+(l-b)*(l-b));n<e&&(g=k,f=l,e=n,c=a[t].angle)}d.push({x:g,y:f,angle:c})}},_belongs:function(b,a,d,h,g,f){if(g==d&&f==h)return!1;if(g>d){if(b>g||b<d)return!1}else if(b<g||b>d)return!1;if(f>h){if(a>f||
a<h)return!1}else if(a<f||a>h)return!1;return!0},_angleAndShifts:function(b,a,d,h,g,f,e){for(b=Math.atan2(h-a,d-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;h=Math.sin(b);var c=Math.cos(b);d=a=0;"Above"==f&&(a=g*h*this._scale,d=g*c*this._scale);"Below"==f&&(a=-g*h*this._scale,d=-g*c*this._scale);g=[];g.angle=e?-b:0;g.shiftX=-a;g.shiftY=d;return g},_generatePolygonPositionsForManyLabels:function(b,a,d,h,g,f,e){g=this._findCentroidForRing(b);h=g[0];var c=g[1],t=this._calcRingExtent(b);
g=t.xmin;f=t.ymin;var k=t.xmax,t=t.ymax,l=(t-f)/(this._map.height*this._scale);if(!(10<(k-g)/(this._map.width*this._scale)&&10<l)){var n=!0;if(k-g>this._map.width*this._scale||t-f>this._map.height*this._scale)n=!1;var l=this._map.width*this._scale*(n?.1875:.5),n=this._map.height*this._scale*(n?.1875:.5),m=!0,q=!0,p=0;do{c+=(p%2?-1:1)*p*n;if(this._scanRingByX(d,a,b,h,c,g,k,l,e))break;c<f&&(m=!1);c>t&&(q=!1);p++}while(m||q)}},_scanRingByX:function(b,a,d,h,g,f,e,c,k){var t=!0,l=!0,n=0,m=1E3;do{h+=(n%
2?-1:1)*n*c;var q=this._movePointInsideRing(d,h,g),p=this._labelLayer._isWithinScreenArea(new C(q,g,q,g,a)),r=this._isPointWithinRing(b,d,q,g);if(p&&r)return k.push({x:q,y:g}),!0;h<f&&(t=!1);h>e&&(l=!1);n++;m--;if(0>=m)return!0}while(t||l);return!1},_movePointInsideRing:function(b,a,d){for(var h=[],g=b.length-1,f=b[0][1]>=b[g][1]?1:-1,e=0;e<=g;e++){var c=e,k=e+1;e==g&&(k=0);var l=b[c][0],c=b[c][1],m=b[k][0],k=b[k][1],n=k>=c?1:-1;if(c<=d&&d<=k||k<=d&&d<=c)d!=c&&d!=k?(h.push((d-c)*(m-l)/(k-c)+l),f=
n):d==c&&d!=k?(f!=n&&h.push(l),f=n):d!=c&&d==k?(h.push(m),f=n):d==c&&d==k&&(1==f&&h.push(l),h.push(m),f=n)}h.sort(function(a,b){return a-b});b=h.length;if(0<b){for(e=d=a=0;e<b-1;e+=2)g=Math.abs(h[e+1]-h[e]),g>a&&(a=g,d=e);a=(h[d]+h[d+1])/2}return a},_calcRingExtent:function(b){var a,d;d=new C;for(a=0;a<b.length-1;a++){var h=b[a][0],g=b[a][1];if(void 0===d.xmin||h<d.xmin)d.xmin=h;if(void 0===d.ymin||g<d.ymin)d.ymin=g;if(void 0===d.xmax||h>d.xmax)d.xmax=h;if(void 0===d.ymax||g>d.ymax)d.ymax=g}return d},
_isPointWithinPolygon:function(b,a,d,h){var g;for(g=0;g<a.rings.length;g++)if(this._isPointWithinRing(b,a.rings[g],d,h))return!0;return!1},_isPointWithinRing:function(b,a,d,h){var g,f,e,c,k=[],l=a.length;for(b=0;b<l-1;b++)if(g=a[b][0],f=a[b][1],e=a[b+1][0],c=a[b+1][1],g!=e||f!=c){if(f==c)if(h==f)k.push(g);else continue;g==e?(f<c&&h>=f&&h<c&&k.push(g),f>c&&h<=f&&h>c&&k.push(g)):(f=(e-g)/(c-f)*(h-f)+g,g<e&&f>=g&&f<e&&k.push(f),g>e&&f<=g&&f>e&&k.push(f))}k.sort(function(a,b){return a-b});for(b=0;b<k.length-
1;b++)if(g=k[b],e=k[b+1],d>=g&&d<e)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,d=[0,0],h=0,g=b[0][0],f=b[0][1],e=1;e<a-1;e++){var c=b[e][0],k=b[e][1],l=b[e+1][0],m=b[e+1][1],n=(c-g)*(m-f)-(l-g)*(k-f);d[0]+=n*(g+c+l);d[1]+=n*(f+k+m);h+=n}d[0]/=3*h;d[1]/=3*h;return d},_findCentroidForFeature:function(b){for(var a=0,d=[0,0],h=0;h<b.rings.length;h++)for(var g=b.rings[h],f=g.length,e=g[0][0],c=g[0][1],k=1;k<f-1;k++){var l=g[k][0],m=g[k][1],n=g[k+1][0],q=g[k+
1][1],r=(l-e)*(q-c)-(n-e)*(m-c);d[0]+=r*(e+l+n);d[1]+=r*(c+m+q);a+=r}d[0]/=3*a;d[1]/=3*a;return d},_findPlace:function(b,a,d,h,g,f,e){if(isNaN(d)||isNaN(h))return!1;for(var c=0;c<this._placedLabels.length;c++){var l=this._placedLabels[c].angle,m=this._placedLabels[c].width*this._scale,q=this._placedLabels[c].height*this._scale,n=this._placedLabels[c].x-d,r=this._placedLabels[c].y-h;if(0===g&&0===l){if(this._findPlace2(-f*this._scale,-e*this._scale,f*this._scale,e*this._scale,n-m,r-q,n+m,r+q))return!1}else{var v=
new C(-f*this._scale,-e*this._scale,f*this._scale,e*this._scale,null),p=0,w=1;0!==g&&(p=Math.sin(g),w=Math.cos(g));var F=n*w-r*p,n=n*p+r*w,l=l-g,p=Math.sin(l),w=Math.cos(l),B=-m*w- -q*p,r=-m*p+-q*w,l=+m*w- -q*p,H=+m*p+-q*w,m=F+B,q=n-r,p=F+l,w=n-H,B=F-B,r=n+r,F=F-l,n=n+H,l=new k;l.addRing([[m,q],[p,w],[B,r],[F,n],[m,q]]);if(v.intersects(l))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;c={};c.layer=b;c.text=a;c.angle=g;c.x=d;c.y=h;c.width=f;c.height=e;this._placedLabels.push(c);
return!0},_findPlace2:function(b,a,d,h,g,f,e,c){return(b>=g&&b<=e||d>=g&&d<=e||b<=g&&d>=e)&&(a>=f&&a<=c||h>=f&&h<=c||a<=f&&h>=c)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../support/expressionUtils".split(" "),function(l,
m,r,w,C,q,k,b,a,d,h,g,f,e,c,t,x,u,n,D,v,p,A,F,B,H){function z(a){return"sizeInfo"===a.type}l=m(A,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=r.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
r.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)k.disconnect(this._mapEventHandlers[a]);this.refresh();e.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var f=[];f.push(a.on("update-end",
r.hitch(this,"refresh")));f.push(a.on("suspend",r.hitch(this,"refresh")));f.push(a.on("resume",r.hitch(this,"refresh")));f.push(a.on("edits-complete",r.hitch(this,"refresh")));f.push(a.on("labeling-info-change",r.hitch(this,"refresh")));f.push(a.on("time-extent-change",r.hitch(this,"refresh")));f.push(a.on("show-labels-change",r.hitch(this,"refresh")));f.push(a.on("feature-reduction-change",r.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,
LabelRenderer:b,EventHandlers:f});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=q.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)k.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)k.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=e.setTimeout(this._refreshLabels,e.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,d,f,e,g,h=[],k,l="DYNAMIC"===this._engineType?new c:new t;if(this._map){l.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(b=
this._featureLayerInfos[a],g=this._convertOptions(null),b.LabelRenderer){if(h=d.labelingInfo)if(k=h[0])e=this._getLabelExpression(k),g=this._convertOptions(k);f=b.LabelRenderer;b.LabelExpressionInfo&&(e=b.LabelExpressionInfo);b.LabelingOptions&&(g=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(h=b.LabelingOptions.pointPriorities,g.pointPriorities="above-center"==h||"AboveCenter"==h||"esriServerPointLabelPlacementAboveCenter"==h?"AboveCenter":"above-left"==h||"AboveLeft"==
h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":"above-right"==h||"AboveRight"==h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"BelowCenter"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"BelowLeft"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"BelowRight"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"CenterCenter"==h||"esriServerPointLabelPlacementCenterCenter"==
h?"CenterCenter":"center-left"==h||"CenterLeft"==h||"esriServerPointLabelPlacementCenterLeft"==h?"CenterLeft":"center-right"==h||"CenterRight"==h||"esriServerPointLabelPlacementCenterRight"==h?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(g.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(g.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(g.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(g.howManyLabels=b.LabelingOptions.howManyLabels));f instanceof F&&(e=this._getLabelExpression(f),f=new B(f.symbol),g=this._convertOptions(f));this._addLabels(d,f,e,g)}else if(h=d.labelingInfo)for(b=h.length-1;0<=b;b--)if(k=h[b])f=new F(k instanceof F?k.toJson():k),e=this._getLabelExpression(k),g=this._convertOptions(k),this._addLabels(d,f,e,g);e=l._process(this._preparedLabels);this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],f=d.x,e=d.y,h=d.text,k=d.angle,l=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&l.setAngle(180/Math.PI*k);l.setText(h);d=f;l instanceof u&&(f=l.getHeight(),d-=.25*f*this._scale*Math.sin(k),e-=.33*f*this._scale);k=new g(new v(d,e,a.extent.spatialReference));k.setSymbol(l);this.add(k)}},_addLabels:function(a,b,c,d){var f,e,g,h;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var k=this._map,l=!a.url&&!k.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(e=a.graphics[f],!1!==e.visible&&!e._suspended){g=e.geometry;if(l){if(!p.canProject(g,k))continue;g=p.project(g,k)}g&&this._isWhere(b.where,e.attributes)&&this._isWithinScreenArea(g)&&(h=this._buildLabelText(c,e,a.fields,d),this._addLabel(h,b,a.renderer,e,d,g,k))}}},_isWithinScreenArea:function(a){a="point"===a.type?new D(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),f=c[3],e=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(f){case "AND":return d&&e;case "OR":return d||e}}}return!1}catch(L){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||q.filter(a.visualVariables,z)[0]:null},_addLabel:function(b,c,d,f,e,g,h){var k,l,m,p;if(b&&""!==r.trim(b)&&c){b=b.replace(/\s+/g," ");k=c.getSymbol(f);k instanceof u?(k=new u(k.toJson()),k.setVerticalAlignment("baseline"),k.setHorizontalAlignment("center")):k=k instanceof n?new n(k.toJson()):new u;k.setText(b);c.symbol=k;if(m=this._getProportionalSize(c.sizeInfo,f.attributes))k instanceof u?k.setSize(m):k instanceof
n&&(k.setWidth(m),k.setHeight(m));p=m=0;if(d){l=d.getSymbol(f);var q=this._getSizeInfo(d);if((d=q?d.getSize(f,{sizeInfo:q,resolution:h.getResolutionInMeters()}):f.size)&&null!==d)m=p=d;else if(l)if("simplemarkersymbol"==l.type)p=m=l.size;else if("picturemarkersymbol"==l.type)m=l.width,p=l.height;else if("simplelinesymbol"==l.type||"cartographiclinesymbol"==l.type)m=l.width}d={};d.graphic=f;d.options=e;d.geometry=g;d.labelRenderer=c;d.labelSymbol=k;d.labelWidth=k.getWidth()/2;d.labelHeight=k.getHeight()/
2;d.symbolWidth=a.normalizedLength(m)/2;d.symbolHeight=a.normalizedLength(p)/2;d.text=b;d.angle=k.angle;this._preparedLabels.push(d)}},_buildLabelText:function(a,b,c,d){if(d.hasExpression)return a=d.arcadeCache,b=b._getDataValue(a.attributeInfo,a,H),h.isDefined(b)?""+b:"";var e=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,g=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var g=e[c[b].name],k=c[b].domain;if(k&&r.isObject(k)){if("codedValue"==k.type&&d.useCodedValues)for(b=g,a=0;a<k.codedValues.length;a++)if(k.codedValues[a].code==
b){g=k.codedValues[a].name;break}break}k=c[b].type;if(d.fieldInfos){var l=d.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==k?(a="DateFormat"+f.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(g=h.substitute({myKey:g},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||!a||(g=w.format(g,{places:a.places}),a.digitSeparator||C.group&&
(g=g.replace(new RegExp("\\"+C.group,"g"),"")));break}}break}else g="";return null==g?"":g})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,
b){if(!a)return null;b=h.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&b)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(b-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,f=null,e="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),f=a.fieldInfos,e=a.labelPlacement,null!=a.useCodedValues&&(b=
a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=x.createAttributeCache({valueExpression:l},!0))}if("always-horizontal"==e||"esriServerPolygonPlacementAlwaysHorizontal"==e)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:f,pointPriorities:"above-center"==e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":"above-right"==e||"esriServerPointLabelPlacementAboveRight"==
e?"AboveRight":"below-center"==e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"esriServerPointLabelPlacementCenterCenter"==e?"CenterCenter":"center-left"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"esriServerPointLabelPlacementCenterRight"==e?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==
e||"below-start"==e||"center-start"==e?"PlaceAtStart":"above-end"==e||"below-end"==e||"center-end"==e?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==e||"esriServerLinePlacementAboveAfter"==e||"above-along"==e||"esriServerLinePlacementAboveAlong"==e||"above-before"==e||"esriServerLinePlacementAboveBefore"==e||"above-start"==e||"esriServerLinePlacementAboveStart"==e||"above-end"==e||"esriServerLinePlacementAboveEnd"==e?"Above":"below-after"==e||"esriServerLinePlacementBelowAfter"==e||
"below-along"==e||"esriServerLinePlacementBelowAlong"==e||"below-before"==e||"esriServerLinePlacementBelowBefore"==e||"below-start"==e||"esriServerLinePlacementBelowStart"==e||"below-end"==e||"esriServerLinePlacementBelowEnd"==e?"Below":"center-after"==e||"esriServerLinePlacementCenterAfter"==e||"center-along"==e||"esriServerLinePlacementCenterAlong"==e||"center-before"==e||"esriServerLinePlacementCenterBefore"==e||"center-start"==e||"esriServerLinePlacementCenterStart"==e||"center-end"==e||"esriServerLinePlacementCenterEnd"==
e?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,arcadeCache:h}}});b("extend-esri")&&r.setObject("layers.LabelLayer",l,d);return l});